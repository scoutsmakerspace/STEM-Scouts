---
layout: null
permalink: /assets/data/activities_index.json
---
{% comment %}Allowed badges (filtered via badges_master.json){% endcomment %}
{% assign allowed_badge_ids = "" %}
{% for _b in site.data.badges_master %}{% assign allowed_badge_ids = allowed_badge_ids | append: _b.id | append: "||" %}{% endfor %}
[
{% for a in site.activities %}
  {%- assign ids = "" -%}

  {%- if a.badge_links -%}
    {%- for bl in a.badge_links -%}
      {%- if bl.badge_id -%}
        {%- assign ids = ids | append: bl.badge_id | append: "||" -%}
      {%- elsif bl.badge -%}
        {%- assign ids = ids | append: bl.badge | append: "||" -%}
      {%- endif -%}
    {%- endfor -%}
  {%- endif -%}

  {%- if a.badges -%}
    {%- for b in a.badges -%}
      {%- if b.badge_id -%}
        {%- assign ids = ids | append: b.badge_id | append: "||" -%}
      {%- elsif b.badge -%}
        {%- assign ids = ids | append: b.badge | append: "||" -%}
      {%- else -%}
        {%- if b -%}
          {%- assign ids = ids | append: b | append: "||" -%}
        {%- endif -%}
      {%- endif -%}
    {%- endfor -%}
  {%- endif -%}

  {%- assign id_list = ids | split: "||" | uniq -%}

  {
    "title": {{ a.title | jsonify }},
    "url": {{ a.url | relative_url | jsonify }},
    {%- assign filtered_ids = "" -%}

    {%- assign id_list = ids | split: "||" -%}

    {%- for _id in id_list -%}

      {%- if _id != "" and allowed_badge_ids contains _id | append: "||" -%}

        {%- assign filtered_ids = filtered_ids | append: _id | append: "||" -%}

      {%- endif -%}

    {%- endfor -%}

    {%- assign ids = filtered_ids -%}

    "badge_ids": [
      {%- assign first = true -%}
      {%- for id in id_list -%}
        {%- assign tid = id | strip -%}
        {%- if tid != "" -%}
          {%- unless first -%},{%- endunless -%}{{ tid | jsonify }}
          {%- assign first = false -%}
        {%- endif -%}
      {%- endfor -%}
    ]
  }{% unless forloop.last %},{% endunless %}
{% endfor %}
]